neighbourhood, long_wgs84, lat_wgs84,
fatalities, injury_collisions, ftr_collisions,
pd_collisions, automobile, motorcycle, passenger, bicycle,
pedestrian))
head(dat_final)
# Chunk 9: table: data dictionary
dataDict <- tribble(
~Column,            ~Description,
"id",                     "Unique identifier for each traffic collision",
"date",                   "Date collision occurred",
"day",                    "Day of the week the traffic collision occurred",
"month",                  "Month the traffic collision occurred",
"year",                   "Year the traffic collision occurred",
"hour",                   "Hour of the day the traffic collision occurred (24hr clock)",
"neighbourhood",          "Greater Toronto Area neighborhood where the traffic collision occurred",
"long_wgs84",             "Longitude for the location of the collision in WGS84 encoding",
"lat_wgs84",              "Latitude for the location of the collison in WGS84 encoding",
"injury_collisions",      "Collisions that resulted in a fatality (binary column where 1 = Yes, 0 = No)",
"ftr_collisions",         "Collisions where a driver fails to remain at the scene (binary column where 1 = Yes, 0 = No)",
"pd_collisions",          "Collisions that resulted in property damage (binary column where 1 = Yes, 0 = No)",
"automobile",             "Collisions where and automobile is involved (car, truck etc.) (binary column where 1 = Yes, 0 = No)",
"motorcycle",             "Collisions where a motorcycle is involved (binary column where 1 = Yes, 0 = No)",
"passenger",              "Collisions where a passenger is involved (binary column where 1 = Yes, 0 = No)",
"bicycle",                "Collisions where a bicycle is involved (binary column where 1 = Yes, 0 = No)",
"pedestrian",             "Collisions where a pedestrian is involved (binary column where 1 = Yes, 0 = No)"
)
kable(dataDict, caption="Toronto Traffic Collision Data")
# Chunk 10
#str(dat_final)
#summary(dat_final)
# Chunk 11
# Select numeric columns
num_vars <- names(select(dat_final, where(is.numeric)))
# Calculate stats per variable and combine
numeric_summary <- lapply(num_vars, function(var) {
data.frame(
Variable = var,
Min = min(dat_final[[var]], na.rm = TRUE),
Q1 = quantile(dat_final[[var]], 0.25, na.rm = TRUE)[[1]],
Median = median(dat_final[[var]], na.rm = TRUE),
Mean = mean(dat_final[[var]], na.rm = TRUE),
Q3 = quantile(dat_final[[var]], 0.75, na.rm = TRUE)[[1]],
Max = max(dat_final[[var]], na.rm = TRUE)
)
}) %>%
bind_rows() %>%
mutate(across(Min:Max, ~round(., 2)))
# Print LaTeX table
kable(numeric_summary,
format = "latex",
booktabs = TRUE,
caption = "Descriptive Summary of Numeric Variables") %>%
kable_styling(latex_options = c("hold_position", "striped"))
# Chunk 12
binary_cols <- c("fatalities", "injury_collisions", "ftr_collisions", "pd_collisions",
"automobile", "motorcycle", "passenger", "bicycle", "pedestrian")
vehicle_cols <- c("automobile", "motorcycle", "bicycle", "pedestrian")
# Chunk 13
binary_summary <- dat_final %>%
summarise(across(all_of(binary_cols),
list(mean = ~mean(., na.rm = TRUE),
sd = ~sd(., na.rm = TRUE),
count_1 = ~sum(. == 1, na.rm = TRUE),
count_0 = ~sum(. == 0, na.rm = TRUE))))
# Pivot to long format for table
binary_table <- binary_summary %>%
pivot_longer(
everything(),
names_to = c("variable", ".value"),
names_sep = "_"
)
# Create LaTeX table
kable(binary_table,
format = "latex",
booktabs = TRUE,
caption = "Summary Statistics for Binary Variables") %>%
kable_styling(latex_options = c("hold_position"))
# Chunk 14
binary_counts <- dat_final %>%
summarise(across(all_of(vehicle_cols), ~sum(. == 1, na.rm = TRUE))) %>%
pivot_longer(cols = everything(), names_to = "variable", values_to = "count")
ggplot(binary_counts, aes(x = reorder(variable, -count), y = count, fill = variable)) +
geom_bar(stat = "identity") +
labs(title = "Number of Collisions by Type", x = "Collision Type", y = "Count of 'Yes'") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::comma)
# Chunk 15
# --- Counts instead of proportions, and months in order ---
monthly_summary <- dat_final %>%
mutate(month = factor(month,
levels = c("January", "February", "March", "April", "May", "June",
"July", "August", "September", "October", "November", "December"))) %>%
group_by(month) %>%
summarise(total_fatalities = sum(fatalities, na.rm = TRUE),
total_injuries = sum(injury_collisions, na.rm = TRUE))
ggplot(monthly_summary, aes(x = month, y = total_injuries, fill = month)) +
geom_bar(stat = "identity") +
labs(title = "Total Injury Collisions by Month", x = "Month", y = "Total Collisions") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
# Chunk 16
day_summary <- dat_final %>%
mutate(day = factor(day,
levels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday",
"Saturday"))) %>%
group_by(day) %>%
summarise(prop_injuries = sum(injury_collisions, na.rm = TRUE))
ggplot(day_summary, aes(x = day, y = prop_injuries, fill = day)) +
geom_bar(stat = "identity") +
labs(title = "Total Injury Collisions by Day of Week",
x = "Day", y = "Total Injury Collisions") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
# Chunk 17
daily_summary <- dat_final %>%
mutate(month = factor(month,
levels = c("January", "February", "March", "April", "May", "June",
"July", "August", "September", "October", "November", "December"))) %>%
group_by(month, date) %>%      # assuming 'date' exists
summarise(total_injury = sum(injury_collisions, na.rm = TRUE)) %>%
ungroup()
ggplot(daily_summary, aes(x = month, y = total_injury, fill = month)) +
geom_boxplot(outlier.colour = "red", outlier.shape = 16, width = 0.6) +
labs(title = "Daily Injury Collisions by Month",
x = "Month", y = "Daily Injury Collisions") +
theme_minimal(base_size = 13) +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
# Chunk 18
# --- Bar plot for injury collisions by hour ---
hourly_summary <- dat_final %>%
mutate(hour = as.numeric(hour)) %>%
group_by(hour) %>%
summarise(total_automobile = sum(automobile, na.rm = TRUE))
ggplot(hourly_summary, aes(x = hour, y = total_automobile)) +
geom_bar(stat = "identity", fill = "steelblue") +
labs(title = "Automobile Collisions by Hour of Day",
x = "Hour of Day",
y = "Number of Automobile Collisions") +
theme_minimal()
# Chunk 19
# --- Bar plot for injury collisions by hour ---
hourly_summary <- dat_final %>%
mutate(hour = as.numeric(hour)) %>%
group_by(hour) %>%
summarise(total_motorcycle = sum(motorcycle, na.rm = TRUE))
ggplot(hourly_summary, aes(x = hour, y = total_motorcycle)) +
geom_bar(stat = "identity", fill = "green") +
labs(title = "Automobile Collisions by Hour of Day",
x = "Hour of Day",
y = "Number of Automobile Collisions") +
theme_minimal()
# Chunk 20
ggplot(dat_final, aes(x = hour)) +
geom_histogram(binwidth = 1, fill = "skyblue", color = "black") +
labs(title = "Distribution of Collisions by Hour", x = "Hour of Day", y = "Count") +
theme_minimal()
# Chunk 21
# --- Top 6 neighbourhoods by total collisions ---
top_neighbourhoods <- dat_final %>%
filter(neighbourhood != "NSA") %>%  #remove 'NSA' or missing ones
group_by(neighbourhood) %>%
summarise(total_collisions = n()) %>%
arrange(desc(total_collisions)) %>%
slice_head(n = 20)
ggplot(top_neighbourhoods, aes(x = reorder(neighbourhood, total_collisions), y = total_collisions)) +
geom_bar(stat = "identity", fill = "tomato") +
coord_flip() +
labs(title = "Top 20 Neighbourhoods by Total Collisions",
x = "Neighbourhood",
y = "Total Collisions") +
theme_minimal()
# Chunk 22
scatter_data <- dat_final %>%
group_by(month) %>%
summarise(injury = sum(injury_collisions, na.rm = TRUE),
property_damage = sum(pd_collisions, na.rm = TRUE))
ggplot(scatter_data, aes(x = injury, y = property_damage, label = month)) +
geom_point(color = "darkred", size = 3) +
geom_text(vjust = -0.5, size = 3) +
labs(title = "Relationship Between Injury and Property-Damage Collisions by Month",
x = "Injury Collisions", y = "Property-Damage Collisions") +
theme_minimal()
# Chunk 23
# --- Scatterplot: Fatalities vs Injury Collisions ---
scatter_fatal <- dat_final %>%
group_by(month) %>%
summarise(
total_fatalities = sum(fatalities, na.rm = TRUE),
total_injury = sum(injury_collisions, na.rm = TRUE)
)
ggplot(scatter_fatal, aes(x = total_injury, y = total_fatalities, label = month)) +
geom_point(color = "darkred", size = 3) +
geom_text(vjust = -0.5, size = 3) +
labs(
title = "Relationship between Fatalities and Injury Collisions (by Month)",
x = "Total Injury Collisions",
y = "Total Fatalities"
) +
theme_minimal()
# Chunk 24
# --- Chi-Square Tests ---
# H1: Collisions are not uniformly distributed across hours of the day
dat_final <- dat_final %>%
mutate(hour_group = case_when(
hour >= 0  & hour <= 2  ~ "00-02",
hour >= 3  & hour <= 5  ~ "03-05",
hour >= 6  & hour <= 8  ~ "06-08",
hour >= 9  & hour <= 11 ~ "09-11",
hour >= 12 & hour <= 14 ~ "12-14",
hour >= 15 & hour <= 17 ~ "15-17",
hour >= 18 & hour <= 20 ~ "18-20",
hour >= 21 & hour <= 23 ~ "21-23"
))
counts <- dat_final %>%
count(hour_group)
obs_h1<- counts$n
exp_h1 <- rep(1/8, 8)
chisq_h1 <- chisq.test(obs_h1, p = exp_h1)
chisq_h1
# H2: Collisions are not uniformly distributed across days of the week
obs_h2 <- table(dat_final$day)
chisq.test(obs_h2)
# H3: Collisions are not uniformly distributed across seasonal groups
monthly_counts <- dat_final %>%
mutate(month = month(date, label = TRUE, abbr = TRUE)) %>%
count(month)
seasonal_counts <- monthly_counts %>%
mutate(
month_group = case_when(
month %in% c("Jan","Feb","Mar") ~ "Jan-Mar",
month %in% c("Apr","May","Jun") ~ "Apr-Jun",
month %in% c("Jul","Aug","Sep") ~ "Jul-Sep",
month %in% c("Oct","Nov","Dec") ~ "Oct-Dec"
)
) %>%
group_by(month_group) %>%
summarise(n = sum(n))
obs_h3 <- seasonal_counts$n
chisq_h3 <- chisq.test(obs_h3, p = rep(1/4, 4))
#chisq_h3
# Chunk 25
# H1: Hours
h1_df <- data.frame(
Hypothesis = "H1: Hourly collisions",
Chi_Squared = chisq_h1$statistic,
df = chisq_h1$parameter,
p_value = chisq_h1$p.value
)
# H2: Days
chisq_h2 <- chisq.test(obs_h2)
h2_df <- data.frame(
Hypothesis = "H2: Day of week collisions",
Chi_Squared = chisq_h2$statistic,
df = chisq_h2$parameter,
p_value = chisq_h2$p.value
)
# H3: Seasonal groups
h3_df <- data.frame(
Hypothesis = "H3: Seasonal collisions",
Chi_Squared = chisq_h3$statistic,
df = chisq_h3$parameter,
p_value = chisq_h3$p.value
)
# Combine all
chisq_summary <- bind_rows(h1_df, h2_df, h3_df)
chisq_summary <- chisq_summary %>%
mutate(
Chi_Squared = round(as.numeric(Chi_Squared), 2),
p_value = ifelse(p_value < 0.001, "<0.001", round(p_value, 3))
)
knitr::kable(chisq_summary,
format = "latex",
booktabs = TRUE,
caption = "Chi-Squared Tests for Collision Distributions") %>%
kable_styling(latex_options = c("hold_position", "striped"))
# Chunk 26
# --- ANOVA Tests ---
# H1: Collisions by hour of day
hourly_daily <- aggregate(list(count = dat_final$hour),
by = list(day = dat_final$day, hour = dat_final$hour),
FUN = length)
# Convert predictors to factors
hourly_daily$hour <- as.factor(hourly_daily$hour)
hourly_daily$day <- as.factor(hourly_daily$day)
# Run ANOVA
anova_hour <- aov(count ~ hour, data = hourly_daily)
summary(anova_hour)
# H2: Collisions by day of week
daily_monthly <- aggregate(list(count = dat_final$day),
by = list(month = dat_final$month, day = dat_final$day),
FUN = length)
daily_monthly$day <- as.factor(daily_monthly$day)
daily_monthly$month <- as.factor(daily_monthly$month)
anova_day <- aov(count ~ day, data = daily_monthly)
summary(anova_day)
# H3: Collisions by month of year
monthly_yearly <- aggregate(list(count = dat_final$month),
by = list(year = dat_final$year, month = dat_final$month),
FUN = length)
monthly_yearly$month <- as.factor(monthly_yearly$month)
monthly_yearly$year <- as.factor(monthly_yearly$year)
anova_month <- aov(count ~ month, data = monthly_yearly)
#summary(anova_month)
# Chunk 27
# H1: Collisions by hour
anova_hour_df <- tidy(anova_hour) %>%
filter(term != "Residuals") %>%  # keep only the main effect
mutate(Hypothesis = "H1: Hourly collisions") %>%
select(Hypothesis, everything())
# H2: Collisions by day
anova_day_df <- tidy(anova_day) %>%
filter(term != "Residuals") %>%
mutate(Hypothesis = "H2: Day-of-week collisions") %>%
select(Hypothesis, everything())
# H3: Collisions by month
anova_month_df <- tidy(anova_month) %>%
filter(term != "Residuals") %>%
mutate(Hypothesis = "H3: Monthly collisions") %>%
select(Hypothesis, everything())
anova_summary <- bind_rows(anova_hour_df, anova_day_df, anova_month_df) %>%
rename(
DF = df,
`Sum of Squares` = sumsq,
`Mean Square` = meansq,
`F value` = statistic,
`p value` = p.value
) %>%
mutate(
`F value` = round(`F value`, 2),
`p value` = ifelse(`p value` < 0.001, "<0.001", round(`p value`, 3)),
`Sum of Squares` = round(`Sum of Squares`, 2),
`Mean Square` = round(`Mean Square`, 2)
)
kable(anova_summary,
format = "latex",
booktabs = TRUE,
caption = "ANOVA Tests for Collision Counts") %>%
kable_styling(latex_options = c("hold_position", "striped"))
# Chunk 28
#Polygon map for spatial analysis
neigh <- st_read("neighbourhoods-4326.geojson", quiet=TRUE)
#count collisions per neighbourhood
neigh_counts <- dat_final %>%
filter(neighbourhood != "NSA") %>%
group_by(neighbourhood) %>%
summarise(collision_count = n())
#join counts to the polygon file
neigh_joined <- neigh %>%
left_join(neigh_counts, by = c("AREA_NAME" = "neighbourhood"))
#collision coint
neigh_joined$collision_count[is.na(neigh_joined$collision_count)] <- 0
#plot
ggplot() +
geom_sf(data = neigh_joined, aes(fill = collision_count), color = "white", size = 0.2) +
scale_fill_viridis_c(option="rocket", direction=-1) + #reverse colour scale
labs(title = "Traffic Collisions by Neighbourhood",
fill = "Collision Count") +
theme_minimal()
# #animated!
# library(gapminder)
# library(gganimate)
# library(magick)
# collision_count2 <- dat_final %>%
#   count(neighbourhood, year, name = "collision_count2")
#
# neigh_year <- neigh_joined %>%
#   left_join(collision_count2, by = c("AREA_NAME" = "neighbourhood"))
#
# map1 <- ggplot(neigh_year) +
#   geom_sf(aes(fill = collision_count2, group = AREA_NAME), color = "white", size = 0.2) +
#   scale_fill_viridis_c(option="rocket", direction=-1) +
#   theme_minimal()
# animap <- map1 +
#   transition_states(year, transition_length=1,state_length=5) +
#                    ease_aes("linear") +
#                      ggtitle("Traffic Collisions Over the Years",
#                              subtitle = "Year {closest_state}")
#
# animate(animap, fps=10, renderer = gifski_renderer("map.gif"))
# Chunk 29: regression_prep
library(lubridate)
library(dplyr)
# Convert timestamp to actual date
dat_raw$occ_date2 <- as.POSIXct(dat_raw$occ_date / 1000, origin = "1970-01-01")
# Extract month number (1–12)
dat_raw$occ_month <- month(dat_raw$occ_date2)
dat_raw$occ_month_name <- month(dat_raw$occ_date2, label = TRUE, abbr = FALSE)
# Check if month looks correct
table(dat_raw$occ_month)
head(dat_raw[, c("occ_date", "occ_date2", "occ_month")])
# Convert predictors to numeric
dat_raw$occ_hour <- as.numeric(dat_raw$occ_hour)
# Create top 20 neighbourhood list
top20 <- dat_raw %>%
count(neighbourhood_158, sort = TRUE) %>%
slice(1:20) %>%
pull(neighbourhood_158)
dat_raw$neighbourhood_top20 <- ifelse(
dat_raw$neighbourhood_158 %in% top20,
dat_raw$neighbourhood_158,
"Other"
)
dat_raw$neighbourhood_top20 <- factor(dat_raw$neighbourhood_top20)
head(dat_raw)
# Chunk 30: regression_model
library(dplyr)
# Aggregate collisions by month and year
monthly_data <- dat_raw %>%
group_by(occ_year, occ_month) %>%
summarise(collisions = n()) %>%
ungroup()
#head(monthly_data)
# Regression model
model_trend <- lm(
collisions ~ occ_month + occ_year,
data = monthly_data
)
#summary(model_trend)
# Get tidy regression table
regression_table <- tidy(model_trend) %>%
mutate(
estimate = round(estimate, 3),
std.error = round(std.error, 3),
statistic = round(statistic, 3),
p.value = ifelse(p.value < 0.001, "<0.001", round(p.value, 3))
) %>%
rename(
Term = term,
Estimate = estimate,
`Std. Error` = std.error,
`t value` = statistic,
`p value` = p.value
)
knitr::kable(regression_table,
format = "latex",
booktabs = TRUE,
caption = "Regression of Monthly Collisions on Month and Year") %>%
kable_styling(latex_options = c("hold_position", "striped"))
# Chunk 31: time_series_plot
library(ggplot2)
ggplot(monthly_data,
aes(x = as.Date(paste(occ_year, occ_month, "01", sep = "-")),
y = collisions)) +
geom_line(color = "steelblue", size = 1) +
labs(
title = "Monthly Collision Trend in Toronto",
x = "Date",
y = "Number of Collisions"
) +
theme_minimal()
# Chunk 32: seasonality_plot
library(dplyr)
seasonality_data <- monthly_data %>%
group_by(occ_month) %>%
summarise(avg_collisions = mean(collisions))
ggplot(seasonality_data, aes(x = factor(occ_month), y = avg_collisions)) +
geom_bar(stat = "identity", fill = "darkorange") +
labs(
title = "Seasonal Pattern in Collisions (Monthly Average)",
x = "Month (1–12)",
y = "Average Number of Collisions"
) +
theme_minimal()
# Chunk 33: forecast_plot
library(dplyr)
library(ggplot2)
library(lubridate)
# Ensure monthly_data has a proper date column
monthly_data <- monthly_data %>%
mutate(date = as.Date(paste(occ_year, occ_month, "01", sep = "-")))
# Identify last historical month
last_date  <- max(monthly_data$date)
last_year  <- as.numeric(format(last_date, "%Y"))
last_month <- as.numeric(format(last_date, "%m"))
# Generate next 24 months
future_dates <- data.frame(
date = seq(
from = last_date %m+% months(1),
by = "1 month",
length.out = 24
)
)
# Extract year & month for prediction
future_dates$occ_year  <- as.numeric(format(future_dates$date, "%Y"))
future_dates$occ_month <- as.numeric(format(future_dates$date, "%m"))
# Predict collisions
future_dates$predicted_collisions <- predict(model_trend, newdata = future_dates)
# Prepare for plot
plot_data <- monthly_data %>%
mutate(type = "Historical") %>%
select(date, collisions, type)
future_plot <- future_dates %>%
select(date, predicted_collisions) %>%
rename(collisions = predicted_collisions) %>%
mutate(type = "Forecast")
final_plot <- rbind(plot_data, future_plot)
# Final combined plot
ggplot(final_plot, aes(x = date, y = collisions, color = type)) +
geom_line(size = 1.1) +
scale_color_manual(values = c("Historical" = "steelblue", "Forecast" = "red")) +
labs(
title = "Historical and Forecasted Collision Trends",
x = "Date",
y = "Number of Collisions",
color = "Type"
) +
theme_minimal()
\newpage
\newpage
\newpage
